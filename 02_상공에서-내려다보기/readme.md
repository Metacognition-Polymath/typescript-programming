# 2. 타입스크립트 : 3,000 미터 상공에서 내려다보기

- 학습 목표
  - 타입스크립트 컴파일러(TypeScript Compiler, TSC)의 동작원리
  - 타입스크립트의 기능 소개
  - 프로그램 개발에 적용할 수 있는 패턴 등을 소개

## 2.1 컴파일러

- 타입스크립트는 자바스크립트나 자바와 같은 주요 언어와는 다른 방식으로 동작
- 전체 개요

  - 프로그램 - 프로그래머가 작성한 다수의 텍스트 파일로 구성 됨
  - 이 텍스트를 컴파일러라는 특별한 프로그램이 파싱하여
    추상 문법 트리(abstract syntax tree, AST)라는 자료구조로 변환
    - AST는 공백, 주석, 탭 등의 결과를 완전히 무시
  - 컴파일러는 다시 AST를 바이트코드(bytecode)라는 하위 수준의 표현으로 변환
  - 바이트 코드가 만들어졌으면 런타임(runtime)이라는 다른 프로그램에 바이트코드를 입력해 평가하고 결과를 얻을 수 있음

- 즉, 프로그램을 실행한다는 것은 컴파일러가 소스코드를 파싱해 AST로 만들고, 다시 AST를 바이트코드로 변환한 것을 런파임이 평가하도록 지시하는 것

1. 프로그램이 AST로 파싱된다
2. AST가 바이트코드로 컴파일 된다
3. 런파임이 바이트 코드를 평가한다

- 타입스크립트가 다른 언어와 다른 점

  - 컴파일러가 코드를 바이트코드 대신 자바스크립트 코드로 변환한다는 점
  - 이후로는 일반적인 자바스크립트 코드를 실행하듯이 브라우저, NodeJs로 실행할 수 있다.

- 타입 검사기

  - 코드의 타입 안전성을 검증하는 특별한 프로그램

- 타입스크립트의 장점

  - 타입 확인 덕분에 명백한 실수가 들어가지 않게 방지해준다

- 타입 스크립트 컴파일 및 실행

  - (1~3 : TSC가 수행)
  - 1. 타입스크립트 소스 -> 타입스크립트 AST
  - 2. 타입 검사기가 AST를 확인
  - 3. 타입스크립트 AST -> 자바스크립트 소스
    - 타입의 영향을 받지 않음 -> 타입스크립트로 인해 기존 프로그램이 망가질 일은 없음
  - (4~6 : 브라우저, NodeJs 같은 자바스크립트 런타임이 실행)
  - 4. 자바스크립트 소스 -> 자바스크립트 AST
  - 5. AST -> 바이트코드
  - 6. 런타임이 바이트코드를 평가

- 자바스크립트 : 각 엔진에 의해 해석되는(interpreted) 언어이다

  - 엔진의 종류
    - V8 : 크롬, Node.JS, 오페라
    - 스파이몽키 : 파이어폭스
    - JSCore : 사파리
    - 샤크라 : 엣지

## 2.2 타입 시스템

- 타입 시스템의 구분
  - 명시적으로 알려주는 타입
  - 자동으로 타입을 추론하는 타입

```ts
let a: number = 1;
// 어노테이션 : 타입 명시
```

```ts
let a = 1;
// 타입 추론
```

- 타입스크립트는 충분히 추론을 잘 하기 때문에
- 꼭 필요할 때에만 어노테이션을 사용하며, 그렇지 않으면 타입스크립트가 마법처럼 타입을 추론하도록 할 것이다.

### 2.2.1 타입스크립트 vs. 자바스크립트

#### 타입은 어떻게 결정되는가?

| 타입 시스템 기능            | 자바스크립트   | 타입스크립트        |
| --------------------------- | -------------- | ------------------- |
| 타입결정 방식               | 동적           | 정적                |
| 타입이 자동으로 변환되는가? | O              | X(대부분)           |
| 언제 타입을 확인하는가?     | 런타임         | 컴파일 타임         |
| 언제 에러를 검출하는가?     | 런타임(대부분) | 컴파일 타임(대부분) |

- 동적 타입 바인딩이란, 자바스크립트가 프로그램을 실행해야만 특정 데이터 타입을 알 수 있음을 의미
- 타입스크립트는 점진적으로 타입을 확인하는(gradually typed) 언어다.

  - 컴파일 타임에 모든 타입을 알고 있을 때 최상의 결과를 보여주지만
  - 컴파일하는데 반드시 모든 타입을 알아야 하는 것은 아니다

- 자바스크립트를 점진적으로 타입스크립트로 마이그레이션하는 경우가 아니라면
  모든 코드의 타입을 컴파일 타임에 지정하는 것을 목표로 해야한다.

#### 언제 타입을 검사하는가?

- 런타임 vs 입력 즉시

#### 에러는 언제 검출되는가?

- 자바스크립트 : 런타임
- 타입스크립트 : 컴파일 타임, 입력 즉시
  - 스택오버플로, 네트워크 연결 끊김, 잘못된 사용자 입력 등 => 타입스크립트가 컴파일 타임에 검출할 수 없는 런타임 예외도 많다

## 2.3 코드 편집기 설정

`cd 02_상공에서-내려다보기`
`npm init -y`
`npm install --save-dev typescript tslint @type/node`
