# 11장. 자바스크립트와 상호 동작

- 10장 까지는 타입스크립트를 올바로 사용하는 방법을 설명함
- 11장에서는 타입을 쓰지 않는 언어
  - 즉, 서드 파티 자바스크립트 라이브러리를 사용한다거나
  - 빠른 패치를 위해 타입 안전성을 포기하는 등의 상황 같은 실전 상황에서
  - 타입스크립트를 접목하는 방법을 알아본다

#### 학습 목표
- 타입 선언 사용하기
- 자바스크립트에서 타입스크립트로 점진적으로 마이그레이션 하기
- 서드 파티 자바스크립트와 타입스크립트 사용하기

## 11.1 타입 선언
- 타입선언은 .d.ts 확장자를 가진 파일이다.
  - JSDoc 어노테이션과 더불어, 타입 선언은 타입이 없는 자바스크립트 코드에 타입스크립트 타입을 부여할 수 있는 수단이다.

- 타입 선언(.d.ts) vs. 타입스크립트 코드(.ts)
  - 타입만 포함할 수 있고 값은 포함할 수 없다
    - 함수, 클래스, 객체 등을 사용할 수 없음
  - 값을 정의할 수 없지만, declare라는 특별 키워드를 사용해 자바스크립트의 다른 어딘가에 값이 있다는 사실을 선언할 수 있다.
  - 소비자가 볼 수 있는 대상에만 타입을 선언할 수 있다.
    - 노출되지 않은 타입이나 함수 안에 선언된 지역 변수의 타입은 포함할 수 없다.

- tsc로 컴파일 할 때 declarations 플래그를 활성화하면 .d.ts 타입 정의가 생성된다.
  - tsc -d {ObservableSample.ts - 생략 가능}
    - 파일안에 export {} 만 들어있음 - 뭔가 잘못 된 듯
      - RxJS 라이브러리에서 .d.ts가 있어서 안생긴 것 같다
      - 그건 아닌 듯 -> 라이브러리에서 import해서 가져오는 것은 안생기는 것 같다

```ts
// 변환 전 코드
class Observable<T> {
  constructor(public value: T) {
  }
  
  print(value: T) {
    return value;
  }
}

// 변환 후 (tsc -d)
declare class Observable<T> {
    value: T;
    constructor(value: T);
    print(value: T): T;
}
```
- declare 키워드를 확인하자
- 타입선언에서는 클래스를 직접 정의할 수는 없지만, 그 대신 .d.ts파일에 대응하는 자바스크립트 파일 안에 정의했음을 선언(declare)할 수 있다
- declare로 "나의 자바스크립트는 이 타입의 클래스를 익스포트함을 맹세한다"라고 선언하는 것이라고 생각하자
- 구현부는 포함하지 않고 타입만 표시된다
  - 오버로드가 되어있다면 오버로드가 되는 부분까지도 포함되어 표시된다

- 자바스크립트와 .d.ts 조합
  - 파일 크기를 줄일 수 있다
  - 무엇을 임포트해야 하는지가 더 명확해진다(?)
  - 컴파일을 다시 하지 않아도 되므로 TSC 컴파일 시간을 줄일 수 있다
  - 12.1.5 프로젝트 참조에서 소개하는 최적화 기법이 동작하는 이유도 이 때문

- 타입 선언 파일은 다음처럼 활용 된다
  - 1) 타입스크립트로 부터 생성된 자바스크립트 파일에 대응하는 .d.ts파일을 검색한다.
    - 그 결과 타입스크립트가 여러분의 프로젝트에 사용된 탕칩을 알 수 있다. 
  - 2)(VSCode 등) 타입스크립트를 지원하는 코드 편집기는 이 .d.ts 파일들을 읽어해석한 다음
    - 여러분이 코드를 작성할 때(심지어 타입스크립트 코드가 아니더라도) 유용한 타입 힌트를 제공한다.
  - 3) 타입스크립트 코드의 불필요한 재컴파일을 막아주어 컴파일 시간을 크게 줄여준다.

- 타입 선언은 타입스크립트에 "자바스크립트에는 이런저런 정보가 정의되어 있어"라고 알려주는 수단이다.
  - 앰비언트(ambient) : 타입만 선언되어 있는 것
  - 예시
    - 전역 Promise를 폴리필(polyfill)
    - process.env 를 정의한 후 타입스크립트에 알려주기
    - 프로젝트 전역으로 이용할 수 있는 타입을 정의하여 임포트 없이 바로 사용하고자 할 때
    - 타입스크립트에 NPM으로 설치한 서드 파티 모듈이 있음을 알릴 때

- 타입선언
  - 스크립트 모드의 .ts 또는 .d.ts 파일 안에 위치해야 한다
    - 스크립트 모드 : `<script>` 태그를 type="module" 없이 사용하는 것
    - 최상위 영역이 공유 됨
  - 타입 선언 관례
    - 대응하는 .js 파일이 있으면 .d.ts 확장자를 사용
    - 아니면 그냥 .ts 확장자를 사용
  - 타입관련 파일 이름은 본인 마음이고 파일 하나에 원하는 만큼의 타입정의를 추가할 수 있다
  - 최상위 값에는 declare를 붙여서 공유하지만
  - type, interface엔 사용하지 않아도 된다

### 11.1.1 앰비언트 변수 선언

```ts
declare const process1: {
  env: {
    NODE_ENV: 'development' | 'production'
  }
}
```
- 루트 디렉토리에서 선언 해놓으면 하위 폴더들에서 임포트 없이 사용 가능하다

#### TSC 설정 - lib
- window와 document 같은 Web API를 사용하려면 lib에 추가해주면 된다

### 11.1.2 앰비언트 타입 선언
- 명시적으로 import하지 않아도 어디에서든 전역으로 사용할 수 있다

### 11.1.3 앰비언트 모듈 선언
- 깃헙의 DEfinitely Typed에 기여하기 귀찮다면 앰비언트 모듈선언을 사용하자

```ts
declare module 'module-name' {
  export type MyType = number;
}
```

## 자바스크립트에서도 타입체크를 할 수 있다

- tsconfig.json 플래그

```ts
// 타입을 사용하지 않는 자바스크립트 임포트 - 타입 안전성 : 나쁨
{
  allowJs: true
}

// 자바스크립트를 임포트 하고 확인 - 타입 안전성 : 좋음
{
  allowJs: true,
  checkJs: true
}

// JSDoc 어노테이션을 포함하는 자바스크립트를 임포트하고 확인 - 타입 안전성 : 훌륭함
{
  allowJs: true,
  checkJs: true,
  strict: true
}

// 타입 선언을 포함하는 자바스크립트 임포트 - 타입 안전성 : 훌륭함
// 즉, 타입스크립트만 임포트
{
  allowJs: false,
  strict: true
}
```