# 12장. 타입스크립트 빌드 및 실행

- 타입스크립트를 자바스크립트로 컴파일한 이후부터는 과정이 같다
- 타입스크립트 응용 프로그램을 빌드하고 제품화하는 방법을 살펴보자
  - 타입스크립트 응용 프로그램을 빌드하는데 필요한 준비물
  - 서버에서 타입스크립트 응용 프로그램을 빌드하고 실행하기
  - 브라우저에서 타입스크립트 응용 프로그램을 빌드하고 실행하기
  - 타입스크립트를 빌드하고 NPM으로 발행(publish)하기

## 12.1 타입스크립트 프로젝트 빌드하기

### 12.1.1 프로젝트 레이아웃

- 파일 트리 만들기
  - vscode extension
    - file tree generator
    - project-tree

my-app/
├──────dist/
│ ├──index.d.ts
│ ├──index.js
│ └──services/
│ ├──foo.d.ts
│ ├──foo.js
│ ├──bar.d.ts
│ └──bar.js
└──────src/
├──index.ts
└──services/
├──foo.ts
└──bar.ts

- 소스코드는 src/ 에 저장하고
- 컴파일한 결과는 dist/ 에 저장하는 것이 국룰이다
- 두개를 분리할 수 있고 다른 도구들과 통합하기 편해진다
- 버전관리(git) 대상에서 제외하기 쉽다는 장점도 있다

### 12.1.2 부산물

|     타입     | 파일 확장자 |     tsconfig.json 플래그      | 기본적으로 생성? |
| :----------: | :---------: | :---------------------------: | :--------------: |
| 자바스크립트 |     .js     | {"emitDeclarationOnly":false} |        O         |
|   소스 맵    |   .js.map   |      {"sourceMap":true}       |        X         |
|  타입 선언   |    .d.ts    |     {"declaration":true}      |        X         |
|   선언 맵    |  .d.ts.map  |    {"declarationMap":true}    |        X         |

- 1. 자바스크립트 : TSC는 타입스크립트를 자바스크립트로 변환
- 2. 소스 맵 : 생성된 자바스크립트 코드를 원래 타입스크립트 파일의 행과 열로 연결하는 데 필요한 특별 파일
  - 크롬 DevTools는 자바스크립트 대신 원래의 타입스크립트 코드를 보여준다
- 3. 타입 선언 : 생성된 타입을 다른 타입스크립트 프로젝트에서 이용할 수 있도록 해준다
- 4. 선언 맵 : 타입스크립트 프로젝트의 컴파일 시간을 단축하는 데 사용
  - 12.1.5를 참고하라

### 12.1.3 컴파일 대상 조정

- 자바스크립트는 매년 새로운 버전이 나온다
- 타입스크립트를 자바스크립트로 변환 시 어떤 버전으로 실행할지 결정할 수 있다
- 노드(내가 운영하는 서버)는 선택이 가능하지만 브라우저(내 앱을 사용하는 유저)에선 불가능하다
  - 실행하는 사람이 어떤 브라우저를 사용할지 알 수 없다
  - 최소한의 기능집합을 정의하고, 나머지는 폴리필로 제공하자
    - 사용자가 너무 오래된 버전의 브라우저를 사용할 때만 업그레이드를 권유하는 메세지를 보여주자
- 코드는 가능한 최신버전으로 작성하는 것이 좋다(?) - 개발자 경험(?)

  - 트랜스파일(자동 변환 등)으로 낮은 자바스크립트 버전으로 변환이 가능하다
  - 폴리필 : 실행하려는 자바스크립트 런타임이 포함하지 않는 최신 기능을 폴리필로 제공한다.

- TSC는 트랜스파일은 제공하지만(예전 자바스크립트 버전으로 변환) 폴리필은 자동으로 해주지 않는다

  - target : 트랜스 파일하려는 자바스크립트 버전을 설정 - es5, es2015, 등
  - module : 대상 모듈 시스템을 설정(es2015, commonjs, systemjs 모듈 등)
    - 대상 환경이 NodeJS냐 브라우저냐에 따라 달라짐
  - lib : 타입스크립트에게 대상 환경에서 어떤 자바스크립트 기능을 지원하는지 알려준다
    - es5, es2015, dom 등

- ESNext : 가장 최신 자바스크립트
- 폴리필 시 @babel/polyfill을 설치 후 바벨을 이용해 컴파일할 때 필요한 폴리필을 자동설치하게 할 수 있다

### 12.1.4 소스맵 활성화

- 소스 맵은 트랜스파일된 코드를 원본 코드와 이어주는 정보를 제공
- Rollup같은 압축 프로그램으로 tree-shake를 수행할 수 있다
- 소스맵 단점 : 브라우저 코드에 어느정도의 보안이 요구되는 상황이라면 고객용 브라우저 환경에서는 소스맵을 포함시키지 않는 편이 좋다

### 12.1.5 프로젝트 참조(project reference)

- 응용 프로그램의 크기가 커지면 TSC가 타입을 확인하고 코드를 컴파일하는 데 오래 걸린다

  - 이 문제의 해법으로 TSC는 점직적으로 컴파일과 함께 프로젝트 참조라는 기능을 제공하여 컴파일 시간을 획기적으로 줄였다

- 프로젝트 참조 사용 예
  - 1. 타입스크립트 프로젝트를 여러 프로젝트로 분리한다
    - 수정(변경)될 가능성이 큰 코드들은 같은 디렉터리에 저장하는 방식으로 코드를 쪼갠다
  - 2. 각 프로젝트 디렉터리에 최소한 다음 정보를 포함하는 tsconfig.json을 만든다

```json
{
  "complierOptions": {
    "composite": true,
    "declaration": true,
    "declarationMap": true,
    "rootDir": "."
  },
  "include": ["./**/*.ts"],
  "reference": {
    "path": "..myReferenced"
  }
}
```
